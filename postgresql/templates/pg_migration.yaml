apiVersion: v1
kind: Pod
metadata:
  name: pg-migration
spec:
  containers:
  - name: webapp-cve-processor
    image: "{{ .Values.image.docker_repo }}:{{ .Values.image.webapp }}-{{ .Values.image.webapp_version }}"
    imagePullPolicy: Always

  initContainers:
  - name: flyway-init
    image: "{{ .Values.image.docker_repo }}:{{ .Values.image.pg_container }}-{{ .Values.image.pg_container_version }}"
    imagePullPolicy: Always
    command:
    - "/bin/sh"
    - "-c"
    - "flyway -user={{ .Values.postgres.user }} -password={{ .Values.postgres.password }} -url=jdbc:postgresql://host.docker.internal:5432/cve migrate"
  imagePullSecrets:
  - name: {{ .Values.imagePullSecrets.name }}
  # hostAliases:
  # - ip: {{ .Values.ip }}
  #   # "172.17.0.1"  # Replace with the IP of host-gateway
  #   hostnames:
  #   - {{ .Values.hostname | quote }}
